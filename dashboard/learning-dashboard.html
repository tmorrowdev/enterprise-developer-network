<!DOCTYPE html>
<html>
<head>
    <title>Enterprise Developer Network - Learning Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Load the cre8-wc components -->
    <script type="module" src="https://esm.sh/@cre8_dev/cre8-wc"></script>
    <link href="https://esm.sh/@cre8_dev/cre8-design-tokens@1.0.3/lib/web/brands/cre8/css/tokens_cre8.css" rel="stylesheet" type="text/css"/>
    
    <!-- Load our custom learning progress tracker component -->
    <script type="module" src="../components/learning-progress-tracker/learning-progress-tracker.js"></script>
    
    <style>
        :root {
            color-scheme: dark;
            
            /* Override design tokens for dark mode */
            --cre8-color-background: #1a1a1a;
            --cre8-color-surface: #262626;
            --cre8-color-surface-variant: #404040;
            --cre8-color-on-background: #e5e5e5;
            --cre8-color-on-surface: #e5e5e5;
            --cre8-color-primary: #60a5fa;
            --cre8-color-secondary: #a3a3a3;
            --cre8-color-text: #e5e5e5;
            --cre8-color-text-secondary: #a3a3a3;
            --cre8-color-border: #404040;
            --cre8-color-border-hover: #2563eb;
            
            /* Success/Error/Warning colors for dark mode */
            --cre8-color-success: #10b981;
            --cre8-color-warning: #f59e0b;
            --cre8-color-error: #ef4444;
            --cre8-color-info: #3b82f6;
            
            /* Force dark backgrounds on all elements */
            --background-color: #1a1a1a;
            --surface-color: #262626;
            --text-color: #e5e5e5;
        }
        
        *, *::before, *::after {
            color-scheme: dark;
        }
        
        /* Force dark mode on all cre8 components */
        cre8-button,
        cre8-card,
        cre8-alert,
        cre8-field,
        cre8-modal,
        cre8-progress,
        cre8-loading-spinner,
        learning-progress-tracker,
        [class*="cre8-"] {
            color-scheme: dark;
            --background: var(--cre8-color-surface);
            --color: var(--cre8-color-on-surface);
            --border-color: var(--cre8-color-border);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 24px;
            background: #1a1a1a;
            color: #e5e5e5;
            min-height: 100vh;
            color-scheme: dark;
        }
        
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid #404040;
        }
        
        .nav-tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .nav-tab {
            padding: 12px 24px;
            background: var(--cre8-color-surface);
            border: 1px solid var(--cre8-color-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: var(--cre8-color-text);
        }
        
        .nav-tab:hover {
            border-color: var(--cre8-color-primary);
            background: var(--cre8-color-surface-variant);
        }
        
        .nav-tab.active {
            background: var(--cre8-color-primary);
            border-color: var(--cre8-color-primary);
            color: white;
        }
        
        .dashboard-actions {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--cre8-color-surface);
            border: 1px solid var(--cre8-color-border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--cre8-color-primary);
            margin: 0;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--cre8-color-text-secondary);
            margin: 4px 0 0 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .learning-section {
            margin-bottom: 40px;
        }
        
        .notifications {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .notification {
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-size: 0.875rem;
            min-width: 300px;
            animation: slideIn 0.3s ease;
        }
        
        .notification.success {
            background: var(--cre8-color-success);
        }
        
        .notification.info {
            background: var(--cre8-color-info);
        }
        
        .notification.warning {
            background: var(--cre8-color-warning);
        }
        
        .notification.error {
            background: var(--cre8-color-error);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-actions {
                flex-direction: column;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .quick-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Learning Progress Dashboard</h1>
        <div>
            <cre8-button text="Sync Data" variant="secondary" size="sm" id="sync-btn"></cre8-button>
            <cre8-button text="Export Progress" variant="tertiary" size="sm" id="export-btn"></cre8-button>
        </div>
    </div>

    <div class="nav-tabs">
        <a href="dashboard.html" class="nav-tab">Main Dashboard</a>
        <div class="nav-tab active">Learning Progress</div>
        <a href="validation-report.html" class="nav-tab">Validation Report</a>
    </div>

    <div class="dashboard-actions">
        <cre8-button text="Add Learning Path" variant="primary" id="add-path-btn"></cre8-button>
        <cre8-button text="Set Learning Goal" variant="secondary" id="add-goal-btn"></cre8-button>
        <cre8-button text="Import from CSV" variant="tertiary" id="import-btn"></cre8-button>
        <cre8-button text="Generate Report" variant="tertiary" id="report-btn"></cre8-button>
    </div>

    <div class="quick-stats" id="quick-stats">
        <!-- Stats will be populated dynamically -->
    </div>

    <div class="learning-section">
        <learning-progress-tracker 
            id="main-tracker"
            config='{"showSkills": true, "showGoals": true, "showOverallProgress": true, "enableGoalSetting": true}'
        ></learning-progress-tracker>
    </div>

    <div class="notifications" id="notifications"></div>

    <!-- Modal for adding learning paths -->
    <cre8-modal id="add-path-modal" title="Add Learning Path" size="lg">
        <div slot="body">
            <div style="display: grid; gap: 16px;">
                <cre8-field label="Path Title" id="path-title" required="true"></cre8-field>
                <cre8-field label="Difficulty" id="path-difficulty" type="select">
                    <select slot="input">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </cre8-field>
                <cre8-field label="Estimated Hours" id="path-hours" type="number"></cre8-field>
                <cre8-field label="Modules (comma-separated)" id="path-modules"></cre8-field>
            </div>
        </div>
        <div slot="footer">
            <cre8-button text="Cancel" variant="secondary" id="cancel-path-btn"></cre8-button>
            <cre8-button text="Add Path" variant="primary" id="save-path-btn"></cre8-button>
        </div>
    </cre8-modal>

    <!-- Modal for adding learning goals -->
    <cre8-modal id="add-goal-modal" title="Set Learning Goal" size="lg">
        <div slot="body">
            <div style="display: grid; gap: 16px;">
                <cre8-field label="Goal Title" id="goal-title" required="true"></cre8-field>
                <cre8-field label="Description" id="goal-description"></cre8-field>
                <cre8-field label="Target Completion Date" id="goal-date" type="date"></cre8-field>
                <cre8-field label="Related Learning Path" id="goal-path" type="select">
                    <select slot="input" id="goal-path-select">
                        <option value="">None</option>
                    </select>
                </cre8-field>
            </div>
        </div>
        <div slot="footer">
            <cre8-button text="Cancel" variant="secondary" id="cancel-goal-btn"></cre8-button>
            <cre8-button text="Set Goal" variant="primary" id="save-goal-btn"></cre8-button>
        </div>
    </cre8-modal>

    <script>
        // Enhanced learning data with more comprehensive examples
        const learningData = {
            learning_paths: [
                {
                    id: 'react_fundamentals',
                    title: 'React Fundamentals',
                    difficulty: 'beginner',
                    estimated_hours: 20,
                    modules: ['Components and JSX', 'Props and State', 'Event Handling', 'Lifecycle Methods', 'Hooks Basics'],
                    progress: 75,
                    completed_modules: ['Components and JSX', 'Props and State', 'Event Handling'],
                    status: 'in_progress'
                },
                {
                    id: 'typescript_advanced',
                    title: 'Advanced TypeScript',
                    difficulty: 'advanced',
                    estimated_hours: 40,
                    modules: ['Generics', 'Decorators', 'Advanced Types', 'Utility Types', 'Module Systems', 'Compiler API'],
                    progress: 30,
                    completed_modules: ['Generics'],
                    status: 'in_progress'
                },
                {
                    id: 'web_components',
                    title: 'Web Components with Lit',
                    difficulty: 'intermediate',
                    estimated_hours: 25,
                    modules: ['Custom Elements', 'Shadow DOM', 'Lit Element', 'Testing Components', 'Best Practices'],
                    progress: 60,
                    completed_modules: ['Custom Elements', 'Shadow DOM', 'Lit Element'],
                    status: 'in_progress'
                },
                {
                    id: 'node_backend',
                    title: 'Node.js Backend Development',
                    difficulty: 'intermediate',
                    estimated_hours: 35,
                    modules: ['Express.js Fundamentals', 'Database Integration', 'Authentication & Security', 'API Design', 'Testing & Deployment'],
                    progress: 100,
                    completed_modules: ['Express.js Fundamentals', 'Database Integration', 'Authentication & Security', 'API Design', 'Testing & Deployment'],
                    status: 'completed'
                },
                {
                    id: 'devops_basics',
                    title: 'DevOps Fundamentals',
                    difficulty: 'intermediate',
                    estimated_hours: 30,
                    modules: ['CI/CD Pipelines', 'Docker Containers', 'Kubernetes Basics', 'Monitoring & Logging', 'Infrastructure as Code'],
                    progress: 20,
                    completed_modules: ['CI/CD Pipelines'],
                    status: 'in_progress'
                }
            ],
            skills: [
                {
                    id: 'javascript',
                    name: 'JavaScript',
                    category: 'Programming Languages',
                    level: 'advanced',
                    progress: 85,
                    last_updated: '2024-08-01'
                },
                {
                    id: 'typescript',
                    name: 'TypeScript',
                    category: 'Programming Languages',
                    level: 'intermediate',
                    progress: 70,
                    last_updated: '2024-08-03'
                },
                {
                    id: 'react',
                    name: 'React',
                    category: 'Frontend Frameworks',
                    level: 'advanced',
                    progress: 80,
                    last_updated: '2024-08-05'
                },
                {
                    id: 'nodejs',
                    name: 'Node.js',
                    category: 'Backend Technologies',
                    level: 'expert',
                    progress: 95,
                    last_updated: '2024-07-28'
                },
                {
                    id: 'testing',
                    name: 'Unit Testing',
                    category: 'Development Tools',
                    level: 'intermediate',
                    progress: 65,
                    last_updated: '2024-08-02'
                },
                {
                    id: 'git',
                    name: 'Git & Version Control',
                    category: 'Development Tools',
                    level: 'advanced',
                    progress: 90,
                    last_updated: '2024-07-15'
                },
                {
                    id: 'docker',
                    name: 'Docker',
                    category: 'DevOps',
                    level: 'novice',
                    progress: 25,
                    last_updated: '2024-08-04'
                },
                {
                    id: 'aws',
                    name: 'AWS Cloud Services',
                    category: 'Cloud Platforms',
                    level: 'intermediate',
                    progress: 55,
                    last_updated: '2024-07-20'
                }
            ],
            goals: [
                {
                    id: 'goal1',
                    title: 'Master React Hooks',
                    description: 'Complete understanding of all React hooks including custom hooks and advanced patterns',
                    target_completion_date: '2024-12-31',
                    progress: 60,
                    status: 'active',
                    learning_path_id: 'react_fundamentals'
                },
                {
                    id: 'goal2',
                    title: 'TypeScript Certification',
                    description: 'Achieve Microsoft TypeScript certification and implement advanced type patterns',
                    target_completion_date: '2024-11-15',
                    progress: 25,
                    status: 'active',
                    learning_path_id: 'typescript_advanced'
                },
                {
                    id: 'goal3',
                    title: 'Build Component Library',
                    description: 'Create and publish a comprehensive web component library using Lit',
                    target_completion_date: '2024-10-30',
                    progress: 40,
                    status: 'active',
                    learning_path_id: 'web_components'
                },
                {
                    id: 'goal4',
                    title: 'Contribute to Open Source',
                    description: 'Make meaningful contributions to at least 3 open source projects',
                    target_completion_date: '2024-09-30',
                    progress: 80,
                    status: 'active'
                },
                {
                    id: 'goal5',
                    title: 'Complete DevOps Certification',
                    description: 'Earn AWS DevOps Engineer certification and implement CI/CD best practices',
                    target_completion_date: '2025-02-28',
                    progress: 15,
                    status: 'active',
                    learning_path_id: 'devops_basics'
                }
            ],
            overall_progress: 57
        };

        // Get component and UI references
        const tracker = document.getElementById('main-tracker');
        const quickStats = document.getElementById('quick-stats');
        const notifications = document.getElementById('notifications');
        
        // Modal references
        const addPathModal = document.getElementById('add-path-modal');
        const addGoalModal = document.getElementById('add-goal-modal');

        // Initialize the component
        function initializeTracker() {
            tracker.loading = true;
            
            // Simulate loading delay
            setTimeout(() => {
                tracker.data = learningData;
                tracker.loading = false;
                updateQuickStats();
                showNotification('Learning progress data loaded successfully!', 'success');
            }, 1000);
        }

        // Update quick statistics
        function updateQuickStats() {
            const data = tracker.data;
            if (!data) return;

            const completedPaths = data.learning_paths.filter(p => p.status === 'completed').length;
            const activeGoals = data.goals.filter(g => g.status === 'active').length;
            const totalSkills = data.skills.length;
            const overallProgress = Math.round(data.learning_paths.reduce((sum, p) => sum + (p.progress || 0), 0) / data.learning_paths.length);

            quickStats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${overallProgress}%</div>
                    <div class="stat-label">Overall Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${completedPaths}</div>
                    <div class="stat-label">Completed Paths</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${activeGoals}</div>
                    <div class="stat-label">Active Goals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalSkills}</div>
                    <div class="stat-label">Skills Tracked</div>
                </div>
            `;
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            notifications.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // Event handlers for main buttons
        document.getElementById('sync-btn').addEventListener('click', () => {
            tracker.loading = true;
            setTimeout(() => {
                tracker.loading = false;
                showNotification('Data synchronized successfully!', 'success');
            }, 1500);
        });

        document.getElementById('export-btn').addEventListener('click', () => {
            const data = JSON.stringify(tracker.data, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'learning-progress-export.json';
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Progress exported successfully!', 'success');
        });

        document.getElementById('add-path-btn').addEventListener('click', () => {
            addPathModal.open = true;
        });

        document.getElementById('add-goal-btn').addEventListener('click', () => {
            // Populate learning path options
            const pathSelect = document.getElementById('goal-path-select');
            pathSelect.innerHTML = '<option value="">None</option>';
            if (tracker.data?.learning_paths) {
                tracker.data.learning_paths.forEach(path => {
                    const option = document.createElement('option');
                    option.value = path.id;
                    option.textContent = path.title;
                    pathSelect.appendChild(option);
                });
            }
            addGoalModal.open = true;
        });

        document.getElementById('import-btn').addEventListener('click', () => {
            // Create file input
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv,.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    showNotification(`Importing ${file.name}...`, 'info');
                    setTimeout(() => {
                        showNotification('Import completed successfully!', 'success');
                    }, 2000);
                }
            };
            input.click();
        });

        document.getElementById('report-btn').addEventListener('click', () => {
            showNotification('Generating comprehensive progress report...', 'info');
            setTimeout(() => {
                showNotification('Report generated and emailed!', 'success');
            }, 2000);
        });

        // Modal event handlers
        document.getElementById('cancel-path-btn').addEventListener('click', () => {
            addPathModal.open = false;
        });

        document.getElementById('save-path-btn').addEventListener('click', () => {
            const title = document.getElementById('path-title').value;
            const difficulty = document.getElementById('path-difficulty').value;
            const hours = parseInt(document.getElementById('path-hours').value) || 0;
            const modules = document.getElementById('path-modules').value.split(',').map(m => m.trim()).filter(m => m);

            if (!title || !difficulty || !hours || modules.length === 0) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            const newPath = {
                id: 'path_' + Date.now(),
                title,
                difficulty,
                estimated_hours: hours,
                modules,
                progress: 0,
                completed_modules: [],
                status: 'not_started'
            };

            tracker.addLearningPath(newPath);
            addPathModal.open = false;
            
            // Clear form
            document.getElementById('path-title').value = '';
            document.getElementById('path-hours').value = '';
            document.getElementById('path-modules').value = '';
            
            updateQuickStats();
            showNotification(`Learning path "${title}" added successfully!`, 'success');
        });

        document.getElementById('cancel-goal-btn').addEventListener('click', () => {
            addGoalModal.open = false;
        });

        document.getElementById('save-goal-btn').addEventListener('click', () => {
            const title = document.getElementById('goal-title').value;
            const description = document.getElementById('goal-description').value;
            const date = document.getElementById('goal-date').value;
            const pathId = document.getElementById('goal-path-select').value;

            if (!title || !description || !date) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            const newGoal = {
                id: 'goal_' + Date.now(),
                title,
                description,
                target_completion_date: date,
                progress: 0,
                status: 'active',
                learning_path_id: pathId || undefined
            };

            tracker.addLearningGoal(newGoal);
            addGoalModal.open = false;
            
            // Clear form
            document.getElementById('goal-title').value = '';
            document.getElementById('goal-description').value = '';
            document.getElementById('goal-date').value = '';
            
            updateQuickStats();
            showNotification(`Learning goal "${title}" set successfully!`, 'success');
        });

        // Component event listeners
        tracker.addEventListener('add-learning-path', () => {
            document.getElementById('add-path-btn').click();
        });

        tracker.addEventListener('add-learning-goal', () => {
            document.getElementById('add-goal-btn').click();
        });

        tracker.addEventListener('progress-updated', (e) => {
            const { pathId, progress } = e.detail;
            updateQuickStats();
            showNotification(`Progress updated: ${progress}%`, 'success');
            
            // Here you would typically save to backend
            console.log('Saving progress update:', { pathId, progress });
        });

        tracker.addEventListener('learning-path-added', (e) => {
            const { path } = e.detail;
            console.log('New learning path added:', path);
            
            // Here you would typically save to backend
        });

        tracker.addEventListener('learning-goal-added', (e) => {
            const { goal } = e.detail;
            console.log('New learning goal added:', goal);
            
            // Here you would typically save to backend
        });

        tracker.addEventListener('retry-load', () => {
            initializeTracker();
        });

        // Initialize the dashboard
        initializeTracker();

        // Auto-save functionality (simulated)
        setInterval(() => {
            if (tracker.data) {
                localStorage.setItem('learning-progress-backup', JSON.stringify(tracker.data));
            }
        }, 30000); // Save every 30 seconds

        // Load backup on page refresh if available
        window.addEventListener('beforeunload', () => {
            if (tracker.data) {
                localStorage.setItem('learning-progress-backup', JSON.stringify(tracker.data));
            }
        });
    </script>
</body>
</html>